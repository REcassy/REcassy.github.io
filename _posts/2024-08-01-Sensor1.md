---
title: "RS232 Sniffing am Cassy Sensor 1"
date: 2024-08-01
layout: post
---
# Hard- und Software
In diesem Beitrag kommt folgendes zum Einsatz
* Cassy Lab und Cassy Sensor 1 von LD Didactic
* Digital Discovery und Waveforms von Digilent
* ein unter Aufbau gezeigtes Breadboard
* [cassyspoof][cs-spoof] zum abfangen und verändern der Kommunikation zwischen Cassy Sensor und Cassy Lab

# Aufbau
Hier ist der Aufbau zum Sniffen an der seriellen Schnittstelle des Cassy Sensor 1:

Bild

Verwendet wird der Logikanalysator "Digital Discovery" von Digilent, der hinter einem MAX232 (setzt die Pegel auf TTL um) an RX und TX der seriellen Schnittstelle hängt.
Das Ergebnis sieht so aus:

Bild

# Bitrate
Sucht man sich das kürzeste Signal raus und ermittelt die Zeitdifferenz kann man daraus die Baudrate bestimmen. Im Startzustand scheint das Cassy Sensor 1 mit 38,4 kbps.
Aufmerksame Leser der Cassy Lab Dokumentation wissen, dass das für die höheren verfügbaren Abtastraten der Sensoren nicht ausreichen kann. Daher kann per Befehl eine höhere Bitrate verhandelt werden. Dazu später mehr.

# Initialisierung

# Einfache Sensorabfragen und Cassy-Bus
Klickt man in Cassy Lab einen der Sensoreingänge an (hier: U<sub>A</sub>), so sendet der PC folgende Anfrage

die standardmäßig (keine Beschaltung an U<sub>A</sub>) wie folgt beantwortet wird:

Ändert man diese Antwort probeweise mit cassyspoof in eine zeitegsteuerte Sinuswelle:

so zeigt Cassy Lab entsprechend Spannungen zwischen -12 V und 12 V an. Eine Änderung in Cassy Lab auf Spannung U<sub>B</sub> führt zu der geänderten Abfrage

sodass das dritte Byte anscheinend die Adresse des Eingangs/Sensors am Gerät ist.

# Weitergehende Bemerkungen
* Die hier gezeigte Form der Messwertsimulierung liefert Werte, die vom eingestellten Messbereich abhängen. Das Cassy Sensor scheint also relative Angaben zu liefern. Dazu passt der anscheinend zur Umstellung gedachte Befehl `FF FF FF FF FF`
* Alle tatsächlich vom Cassy Sensor beantworteten Anfragen beginnen mit `FF FF`. Da das direkt folgende Byte die Sensoradresse ist und Cassy Lab zusätzlich Anfragen mit `FF FF` bis `FF FF` sendet, die unbeantwortet bleiben, ist davon auszugehen, dass es sich hierbei um die Adressierung etwaiger weiterer Geräte auf dem (von mir hier so genannten) Cassy Bus (grauer 20 pol. Anschluss) handelt. Das legt nahe, dass die RS232 (und in Konsequenz die USB Schnittstelle an Cassy Sensor USB bzw. Cassy Sensor 2) eher als Router zu diesem Cassy Bus und nicht so sehr als direkte Anbindung des konkreten Geräts zu verstehen ist.

[cs-spoof]: https://github.com/REcassy/cassyspoof
